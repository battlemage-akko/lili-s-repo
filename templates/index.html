{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试用页面</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="shortcut icon" href="{% static 'images/favicon.png' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/layer/3.5.1/layer.js"></script>
    <link href="{% static 'css/wrapper.css' %}" rel="stylesheet">
    <link href="{% static 'css/sidebar.css' %}" rel="stylesheet">
    <link href="{% static 'css/defaultpage.css' %}" rel="stylesheet">
    <link href="{% static 'css/profile.css' %}" rel="stylesheet">
    <link href="{% static 'css/admin.css' %}" rel="stylesheet">
    <link href="{% static 'css/videoslist.css' %}" rel="stylesheet">
    <style>
        :root {
            --Head-top: 80px;
            --Test-color: null;
            --Background-color: #eeeef3;
            --shadow: 0 3px 3px 0 rgba(54, 58, 80, 0.32);
        }
        @font-face {
            font-family: 'IcoMoon-Free';
            src: url('{% static 'css/IcoMoon-Free.ttf'%}') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            scroll-behavior: smooth;
        }

        p {
            margin: 0 !important;
        }

        ul {
            padding-left: 0;
        }

        body {
            background-color: var(--Background-color);
            overflow-x: hidden;
            transition: all .5s ease;
        }
        body::-webkit-scrollbar{
            width: 5px;
            height: 5px;
            scrollbar-arrow-color: red;
        }
        body::-webkit-scrollbar-thumb {/*滚动条里面小方块*/
            border-radius: 5px;
            -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
            background: rgba(0,0,0,0.4);
            scrollbar-arrow-color:red;
        }
        body::-webkit-scrollbar-track {/*滚动条里面轨道*/
            -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
            border-radius: 0;
            background: rgba(0,0,0,0.1);
        }
        #app {
            width: 100vw;
            height: 100vh;
            padding-left: 50px;
            transition: padding-left .5s ease;
        }
        #app.active {
            padding-left: 240px;
        }
        .default {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .videos {
            right: 0;
            width: 100%;
            min-height: 100vh;
            transition: all .5s ease;
            white-space: nowrap;
            display: flex;
            justify-content: center;
        }
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 50px;
            background: #ffffff;
            transition: all 0.5s ease;
            z-index: 3;
            -moz-user-select:none;
            -webkit-user-select:none;
            user-select:none;
        }

        .profile {
            display: flex;
            justify-content: center;
            align-content: center;
        }

        .admin {
            display: flex;
            justify-content: center;
            align-content: center;
            margin-bottom: 35px;
        }

        .profile-background {
            background: url("{% static "images/background.jpg" %}") round;
        }

        .sidebar.active {
            width: 240px;
        }

        .logo.active {
            left: 110px;
            z-index: 4;
            position: fixed;
            opacity: 0.3;
        }

        .sidebar.active .side {
            opacity: 1;
            pointer-events: auto;
        }

        .logo {
            position: fixed;
            width: 140px;
            top: 35px;
            left: 50%;
            z-index: 4;
            transform: translateX(calc(-50% + 6px));
            transition: all 0.5s ease;
            cursor: pointer;
            opacity: 0;
        }

        .logo:hover {
            opacity: 1;
        }

        footer {
            text-align: center;
            background-color: rgb(255, 255, 255);
            line-height: 30px;
            width: 100%;
            height: 30px;
            position: fixed;
            font-size: 12px;
            bottom: 0px;
            z-index: 2;
        }

        footer a {
            color: gray;
            text-decoration: none;
        }

        @media (max-width: 1070px) {
            .profile {
                overflow: hidden;
            }
        }
        .videoslist-title{
            position: relative;
            height: 300px;
            width: 100%;
            display: flex;
            justify-content: center;
            background: url("{% static 'images/videoBackground.jpg' %}") right bottom no-repeat;
            background-size: cover;
        }
    </style>
</head>
<body>
<img src="{% static 'images/logo.png' %}" alt="" class="logo">
    <div id="app" ref="app">
        <div v-show="flags.default" class="default">
            <section>
                <img src="{% static 'images/default/mountain.png' %}" id="mountain">
                <img src="{% static 'images/default/sun.png' %}" id="sun">
                <img src="{% static 'images/default/mountains.png' %}" id="mountains">
                <h2 id="defaulttitle" v-if="is_login" >
                    Welcome
                    <p style="text-align: center">{[ userdetail.name ]}</p>
                </h2>
                <span id="defaultlogin" @click="login"  v-else>Sign in</span>
            </section>
            <div class="defaultdesc" id="defaultdesc">
                <h2>丢臭你（占位）</h2>
                <p>丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你
                    丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你
                    丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你
                    丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你
                    丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你
                    丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你
                    丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你丢臭你
                </p>
            </div>
        </div>
        <div v-show="flags.videos"  class="videos">
            <div class="videos-holder">
                <div class="videoslist-title">
                    <div style="position: absolute" class="videoslist-search">
                        <div>
                            <div class="input-group mb-2">
                          <input type="text" class="form-control videoslist-search-input" placeholder="请输入" aria-label="Recipient's username" aria-describedby="button-addon2">
                          <button class="btn btn-outline-secondary videoslist-search-btn" type="button" id="button-addon2"><i class="videoslist-input-btn"></i></button>
                            </div>
                            <h2 style="font-size: 12px;padding: 0px 30px">
                                推荐: <a href="javascript:"></a>
                            </h2>
                        </div>
                    </div>
                    <span class="videoslist-upload" title="上传" @click="upload_video"></span>
                </div>
                <div style="padding: 0px 20px">
                    <ul class="videoslist-choose">
                        <li @click="changeVideosListTag('new')"><a href="javascript:">最新</a></li>
                        <li @click="changeVideosListTag('popular')"><a href="javascript:">热门</a></li>
                        <li v-if="is_login" @click="changeVideosListTag('follow')"><a href="javascript:">关注</a></li>
                        <li v-if="is_login" @click="changeVideosListTag('collect')"><a href="javascript:">收藏</a></li>
                    </ul>
                </div>
                <ul class="videos-list videos-list-new" v-show="videosList_tags.new">
                    <li v-for="(item,i) in videosList_new" @click="getVideo(item.v_id)" class="videos-each">
                        <div :style="{'background-image': 'url({% static 'videos/videopic/' %}'+item.v_pic+')','background-size':'cover'}" class="videos-each-background"></div>
                        <span class="videos-each-tips">
                            <i class="videos-each-play"></i>
                        </span>
                        <span class="videos-each-time">
                            <span>{[ Math.floor(item.v_duaring/60)<10?"0"+Math.floor(item.v_duaring/60):Math.floor(item.v_duaring/60) ]}:{[ item.v_duaring%60<10?"0"+item.v_duaring%60:item.v_duaring%60 ]}</span>
                        </span>
                        <span class="videos-each-title">
                            <h1>{[ item.v_title ]}</h1>
                            <p>作者 : {[ item.v_auther ]}</p>
                            <p style="right: 10px">播放 : {[ item.v_play ]}</p>
                        </span>
                    </li>
                </ul>
                <ul class="videos-list videos-list-popular" v-show="videosList_tags.popular">
                </ul>
                {% if request.user.is_authenticated %}
                    <ul class="videos-list videos-list-follow" v-show="videosList_tags.follow">
                    </ul>
                    <ul class="videos-list videos-list-collect" v-show="videosList_tags.collect">
                    </ul>
                {% endif %}
                <div class="showmore-div">
                    <button class="btn btn-primary show_more_btn" v-show="show_more_btn" @click="getmorenewvideo"><i class="showmore-div-btn" ></i></button>
                    <div class="no-more" v-show="show_more_cat">
                        <img src="{% static 'images/猫猫叹气.png' %}" alt="">
                    </div>
                </div>
                <div class="videos-notice">
                    <div style="text-align: center;padding: 0px 10px">本站为个人兴趣，非商业用途，所有内容均收集于互联网公开资源，本站只提供WEB页面服务，不提供影片资源储存也不参与录制与上传，若本站收录内容无意侵犯了贵公司版权，请给网页底部邮箱地址来信，我会及时处理，谢谢合作。邮箱:2878305660@qq.com</div>
                </div>
                <div style="height: 30px"></div>
            </div>
        </div>
        <div v-if="is_login" v-show="flags.profile" class="profile">
            <div class="profilecontent">
                <div class="profile-detail">
                    <div class="profile-background">
                    </div>
                    <div style="display: flex;justify-content: center">
                        <img src="{% static "images/头像.png" %}" alt="" class="profile-img">
                    </div>
                    <ul style="list-style: none" class="profile-info">
                        <li>
                            <div>{[ userdetail.name ]}
                                <span v-if="this_user_admin">
                                    (管理员)
                                </span>
                            </div>
                        </li>
                        <li style="display: flex">
                            <div>
                                粉丝:{{ request.user.fans }}
                            </div>
                            <div>
                                获赞:0
                            </div>
                        </li>
                    </ul>
                    <div class="profile-content">
                        <ul class="profile-content-btns">
                            <li class="active" @click="changeProfileContent('myvideos',$event)">upload</li>
                            <li @click="changeProfileContent('mycollection',$event)">star-empty</li>
                        </ul>
                        <div v-if="profile_content.myvideos" style="width: 100%">
                            <div class="profile-content-myvideos-btn">
                                <span @click="active_delbtn">trashcan</span>
                                <hr style="margin: 0">
                            </div>
                            <ul class="profile-content-myvideos">
                                <li v-for="(item,i) in videosList_mine.slice(videosPage.begin,videosPage.end)" class="videos-each" :id="'myvideo_'+item.v_id">
                                    <div :style="{'background-image': 'url({% static 'videos/videopic/' %}'+item.v_pic+')','background-size':'contain'}" class="videos-each-background" @click="getVideo(item.v_id)"></div>
                                    <span class="videos-each-tips" @click="getVideo(item.v_id)">
                                        <i class="videos-each-play"></i>
                                    </span>
                                    <span class="videos-each-title" @click="getVideo(item.v_id)">
                                        <h1>{[ item.v_title ]}</h1>
                                        <p style="right: 10px">播放 : {[ item.v_play ]}</p>
                                    </span>
                                    </span>
                                    <span class="videos-each-del" @click="delVideo($event,item.v_id)">
                                        <p class="videos-each-del-content">cancel</p>
                                    </span>
                                </li>
                            </ul>
                            <div class="page-bar">
                                <span @click="myvideosPrepage">arrow-left2</span>
                                <span @click="myvideosNextpage">arrow-right2</span>
                            </div>
                        </div>
                        <div v-if="profile_content.mycollection" style="width: 100%">
                            <ul class="profile-content-mycollection"></ul>
                        </div>
                    </div>
                </div>
                <div class="profile-other">
                    <div class="profile-id">
                        个人信息
                        <hr/>
                        <span style="font-weight: 600;letter-spacing: 2px"></span><span>id : {{ request.user.id }}</span><span>  加入 : {{ request.user.date_joined }} </span>
                    </div>
                    <div class="profile-message">
                        <ul style="display: flex;list-style: none;justify-content: space-between;margin: 0">
                            <li>消息 <span style="font-family: IcoMoon-Free;cursor: pointer" @click="refreshmsg"> loop2</span></li>
                            <li><span style="font-family: IcoMoon-Free;cursor: pointer" @click="clearmsg">trashcan2</span></li>
                        </ul>
                        <hr/>
                        <ul class="profile-message-content">
                            <li v-for="(item,i) in messages.msg">
                                <p>{[ item ]}</p>
                            </li>
                        </ul>
                    </div>
                    <ul class="profile-tools">
                        <li title="消息" class="profile-chat"><i></i></li>
                        <li title="上传视频" class="profile-upload"><i></i></li>
                        <li title="云盘" class="profile-cloud" @click="tocloud"><i></i></li>
                        <li title="更改个人信息" class="profile-set"><i></i></li>
                        <li title="注销" class="profile-logout" @click="logout"><i></i></li>
                    </ul>
                </div>
            </div>
            <div v-show="showDelMenu" class="del-warning">
                    <div class="del-warning-content">
                        <div class="del-warning-title">
                            <span style="font-size: 15px">删除视频</span>
                            <span @click="closeDelmenu" style="cursor: pointer">close</span>
                        </div>
                        <div class="del-warning-warn">
                            <span style="color: red;font-size: 20px;margin: 0px 20px">warning</span>
                            <span style="color: white;display: flex;align-items: center;font-size: 15px">删除的视频与弹幕不可恢复</span>
                        </div>
                        <div class="del-warning-detail">
                            List:
                            <ul class="del-warning-list">
                                <li v-for="(item,index) in delList">
                                    <a @click="jumpbyv_id(item.v_id)">《 {[item.v_title]} 》</a>
                                </li>
                            </ul>
                        </div>
                        <div class="del-warning-final">
                            <div class="input-group">
                              <input type="text" class="form-control" placeholder="请输入'y'/'Y'进行确认" aria-label="Recipient's username" aria-describedby="button-addon2" v-model="Del_sure">
                              <button class="btn btn-outline-secondary" type="button" id="button-addon2" @click="delVideoSure">确认</button>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
        <div v-if="this_user_admin" v-show="flags.admin" class="admin">
            <div class="admin-content">
                <div class="admin-server">
                    <div class="admin-server-res">
                        <div>
                            <div class="card">
                                <div style="display: flex;justify-content: space-between">
                                    <p style="font-weight: 700" @click="serverDetail">服务器使用 : <i
                                            class="admin-server-res-fresh"></i></p>
                                    <div class="form-check form-switch" title="是否开启自动更新">
                                        开启自动更新
                                        <input class="form-check-input" type="checkbox" role="switch"
                                               id="flexSwitchCheckChecked" v-model="serverupdate">
                                        <label class="form-check-label" for="flexSwitchCheckChecked"></label>
                                    </div>
                                </div>
                                <hr/>
                                <ul class="admin-server-res-detail-li">
                                    <li>CPU : <span> {[ serverDetaillist.CPU ]}</span></li>
                                    <li>内存占用 : <span> {[ serverDetaillist.MEM ]}</span></li>
                                    <li>硬盘使用 : <span> {[ serverDetaillist.DISK ]}</span></li>
                                    <li>流量 : <span> {[ serverDetaillist.NET ]}</span></li>
                                    <li>IP : <span> {[ serverDetaillist.IP ]}</span></li>
                                    <li>服务器已运行时间 : <span> {[ serverDetaillist.TIME ]}</span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="admin-server-user">
                        <div>
                            <div class="card">
                                <p style="font-weight: 700" @click="userDetail">用户 : <i class="admin-server-res-fresh"></i>
                                </p>
                                <hr/>
                                <ul class="admin-user-detail-li">
                                    <li>用户总数 : <span> {[ userDetaillist.USER ]}</span></li>
                                    <li>当前在线人数 : <span> {[ userDetaillist.ONLINE ]}</span></li>
                                    <li>管理员数量 : <span> {[ userDetaillist.ADMIN ]}</span></li>
                                </ul>
                            </div>
                        </div>
                        <div style="margin-top: 20px">
                            <div class="card">
                                <ul class="shutdownorreboot">
                                    <li class="reboot" title="重启" @click="reboot"><i></i></li>
                                    <li class="shutdown" title="关机" @click="shutdown"><i></i></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="admin-info">
                    <div class="admin-terminal">
                        <div>
                            <div class="card">
                                    <ul class = "admin-terminal-list">
                                        <li class = "admin-terminal-input">
                                            <div><input type="text" placeholder="输入用户名，若空则使用默认" class="admin-terminal-user"></div>
                                            <div><input type="password" class="admin-terminal-password"></div>
                                            <div>命令:<input type="text" placeholder="带命令打开终端，若空则不带命令" class="admin-terminal-cmd" v-model="terminal_cmd">#tail -f /data/wwwroot/myproject/uwsgi/uwsgi.log</div>
                                        </li>
                                        <li>
                                            <button type="button" class="btn btn-outline-primary" @click="terminal"><i class="admin-terminal-list-terminal"></i> 连接终端</button>

                                        </li>
                                    </ul>
                            </div>
                        </div>
                    </div>
                    <div class="admin-user-modify">
                        <div>
                            <div class="card admin-user-modify-card">
                                <div style="display: flex;justify-content: space-between">
                                    <p style="font-weight: 700" >修改用户信息 :
                                        <i  @click="getAllUsers"></i>
                                    </p>
                                    <p style="color: red;font-family: '微软雅黑 Light'">{[ Del_msg ]}
                                        <i class="admin-user-show" @click="hidden_user_modify"> </i>
                                    </p>
                                </div>
                                <hr/>
                                <table class="table table-striped table-hover">
                                    <thead>
                                    <tr>
                                        <th scope="col">id</th>
                                        <th scope="col">名字</th>
                                        <th scope="col">邮箱</th>
                                        <th scope="col">最后登录</th>
                                        <th scope="col">封禁</th>
                                        <th scope="col">管理员</th>
                                        <th scope="col">提交修改</th>
                                        <th scope="col">封禁</th>
                                        <th scope="col">删除用户</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr v-for="(item,index) in AllUsers">
                                        <td><p>{[ item.id ]}</p></td>
                                        <td><p>{[ item.username ]}</p></td>
                                        <td><p>{[ item.email ]}</p></td>
                                        <td><p>{[ item.last_login ]}</p></td>
                                        <td><p>{[ !item.is_active ]}</p></td>
                                        <td><p>{[ item.is_superuser ]}</p></td>
                                        <td><p class="admin-user-modify-submit" @click="damie"></p></td>
                                        <td><p class="admin-user-modify-ban" @click="damie"></p></td>
                                        <td><p class="admin-user-modify-kill" @click="Del_user(`${[ item.id ]}`)"></p></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="admin-user-modify">
                        <div>
                            <div class="card">
                                <div style="display: flex;justify-content: space-between">
                                    <p style="font-weight: 700" >举报 :
                                        <i class="admin-user-fresh" @click="getAllUsers"></i>
                                    </p>
                                    <p style="color: red;font-family: '微软雅黑 Light'">{[ Del_msg ]}</p>
                                </div>
                                <hr/>
                                 <table class="table table-striped table-hover">
                                    <thead>
                                    <tr>
                                        <th scope="col">id</th>
                                        <th scope="col">举报人</th>
                                        <th scope="col">举报时间</th>
                                        <th scope="col">举报理由</th>
                                        <th scope="col">驳回</th>
                                        <th scope="col">删除视频</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr v-for="(item,index) in AllUsers">
                                        <td><p>{[ item.id ]}</p></td>
                                        <td><p>{[ item.username ]}</p></td>
                                        <td><p>{[ item.email ]}</p></td>
                                        <td><p>{[ item.last_login ]}</p></td>
                                        <td><p>{[ !item.is_active ]}</p></td>
                                        <td><p>{[ item.is_superuser ]}</p></td>
                                        <td><p class="admin-user-modify-submit" @click="damie"></p></td>
                                        <td><p class="admin-user-modify-ban" @click="damie"></p></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sidebar">
        <div class="logo_content">
            <div class="logo">
                <i></i>
                <div class="logo_name"></div>
            </div>
            <i id="navbtn" @click="showsidebar"></i>
        </div>
        <ul class="searchnav" style="padding: 0px!important">
            <li>
                <input type="search" placeholder="请输入">
                <i class="searchbtn"></i>
            </li>
        </ul>
        <ul class="nav_list" style="padding: 0px!important">
            <li id="default" @click="changePage('default')">
                <i class="homebtn"></i>
                <p>Home</p>
            </li>
            <li id="videos" @click="changePage('videos')">
                <i class="videosbtn"></i>
                <p>视频</p>
            </li>
            {% if request.user.is_authenticated %}
                <li id="profile" @click="changePage('profile')">
                    <i class="profilebtn"></i>
                    <p>个人资料</p>
                </li>
                {% if request.user.is_superuser == True %}
                    <li id="admin" @click="changePage('admin')">
                        <i class="adminbtn"></i>
                        <p>管理</p>
                    </li>
                {% endif %}
            {% endif %}
        </ul>
        <div class="login" @click="login()">
            <img src="{% static 'images/' %}{{ request.user.picture }}" alt="">
            {% if request.user.is_authenticated %}
                <span class="logout" @click="logout"><i></i></span>
                <p class="loginbtn active">
                    {[ userdetail.name ]}
                </p>
            {% else %}
                <p class="loginbtn">
                    Login
                </p>
            {% endif %}
        </div>
        <i class="toolbtn"></i>
        <a href="#" target=""></a>
    </div>
{% include 'wrapper.html' %}
<footer><a href="https://beian.miit.gov.cn/#/Integrated/index">备案号:粤ICP备2021133316号</a></footer>
</body>
<script>
    const siderbar = new Vue({
        el: ".sidebar",
        delimiters: ['{[', ']}'],
        data:{
            userdetail:{
                name: "{{ request.user.username }}",
            }
        },
        methods: {
            login: function () {
                window.open("{% url 'login' %}", "_blank")
            },
            logout: function () {
                window.location.href = "{% url 'logout' %}", "_blank"
            },
            showsidebar: function (){
                document.querySelector("#app").classList.toggle("active")
                document.querySelector(".sidebar").classList.toggle("active")
                document.querySelector(".logo").classList.toggle("active")
                document.querySelector(".nav_list").classList.toggle("active")
                document.querySelector(".toolbtn").classList.toggle("active")
                document.querySelector(".searchnav").classList.toggle("active")
                document.querySelector("#sun").classList.toggle("active")
                if (document.querySelector(".logout")) {
                    document.querySelector(".logout").classList.toggle("active")
                }
            },
            changePage:function (Page){
                for(let key in vm.flags){
                    vm.flags[key] = false
                }
                vm.flags[Page] = true
            }
        },
    })
    const vm = new Vue({
        el: "#app",
        delimiters: ['{[', ']}'],
        data: {
            tmp:document.querySelector(".videos-list-new").scrollHeight,
            show_more_cat:false,
            show_more_btn:true,
            videosList:[],
            delList:[],
            videosList_isLoading:false,
            videosList_new:{{ newvideolist|safe }},
            videosList_hot:{{ hotvideolist|safe }},
            videosList_collect:{{ collectvideolist|safe }},
            videosList_mine:[],
            videosPage:{
                now:"",
                page:"",
                total:"",
                begin: 0,
                end: 8,
            },
            messages: [],
            videosList_tags:{
                "new":true,
                "popular": false,
                "follow": false,
                "collect": false,
            },
            profile_content:{
                "myvideos":true,
                "mycollection":false
            },
            screen_choose: "auto",
            this_user_admin: false,
            is_login: false,
            userdetail:{
                name: "{{ request.user.username }}",
                id: "{{ request.user.id }}",
                email: "{{ request.user.email }}",
                is_active: "{{ request.user.is_active }}",
                date_joined: "{{ request.user.date_joined }}",
                gender: "{{ request.user.gender }}",
                picture: "{{ request.user.picture }}",
                fans: "{{ request.user.fans }}"
            },
            flags: {
                default: true,
                videos: false,
                profile: false,
                admin: false,
            },
            serverDetaillist: {
                CPU: "none",
                MEM: "none",
                DISK: "none",
                TIME: "none",
                NET: "none",
                IP: "none"
            },
            userDetaillist: {
                USER: "none",
                ADMIN: "none",
                ONLINE: "none"
            },
            AllUsers: null,
            showDelMenu: false,
            serverupdate: false,
            Interval: "",
            Del_sure:"",
            Del_msg:null,
            terminal_user: "administrator",
            terminal_password: window.btoa("123456"),
            terminal_cmd:"",
            video_url:"{% url "index" %}"+"video/",
        },
        methods: {
            jumpbyv_id:function (v_id){
                window.open(this.video_url+v_id)
            },
            handleScroll:function (){
                console.log(123)
            },
            hidden_user_modify(){
                document.querySelector(".admin-user-show").classList.toggle("active")
                document.querySelector(".admin-user-modify-card").classList.toggle("active")
            },
            logout: function () {
                window.location.href = "{% url 'logout' %}", "_blank";
            },
            tocloud: function () {
                window.open("https://cloud.lili-secretbase.com/");
            },
            login() {
                window.location.href = "{% url 'login' %}"
            },
            is_login_check() {
                if ("{{ request.user.is_authenticated }}" == "True") {
                    this.is_login = true
                    if("{{ request.user.is_superuser }}" == "True"){
                        this.this_user_admin = true
                    }
                } else {
                    this.is_login = false
                }
            },
            Del_user:async function(id) {
                if(id == this.userdetail.id){
                    this.Del_msg = "删自己？大可不必"
                }
                else{
                    let param = new URLSearchParams()
                    param.append('id', id)
                    result =  await axios({
                        method: 'POST',
                        url: '{% url 'Del_user' %}',
                        data: param
                    });
                    if (result.data.code== "1"){
                        this.getAllUsers()
                        this.userDetail()
                        this.Del_msg = result.data.msg
                        alert("删除成功")
                    }
                    else if (result.data.code== "0"){
                        this.Del_msg = result.data.msg
                    }
                    else{
                        this.Del_msg = "???????????????"
                    }

                }
            },
            changeScreen:function(e){
                this.screen_choose = e.target.innerHTML
            },
            serverDetail: async function () {
                result = await axios({
                    method: 'GET',
                    url: '{% url 'serverDetail' %}',
                });
                if (result.data) {
                    this.serverDetaillist.CPU = result.data.CPU
                    this.serverDetaillist.MEM = result.data.MEM
                    this.serverDetaillist.DISK = result.data.DISK
                    this.serverDetaillist.TIME = result.data.TIME
                    this.serverDetaillist.NET = result.data.NET
                    this.serverDetaillist.IP = result.data.IP
                }
            },
            userDetail: async function () {
                result = await axios({
                    method: 'GET',
                    url: '{% url 'userDetail' %}',
                });
                this.userDetaillist.USER = result.data.USER
                this.userDetaillist.ONLINE = result.data.ONLINE
                this.userDetaillist.ADMIN = result.data.ADMIN
            },
            getAllUsers: async function () {
                result = await axios({
                    method: 'GET',
                    url: '{% url 'getAllUsers' %}',
                });
                this.AllUsers = result.data
                this.Del_msg = null
            },
            damie: function () {
                alert("达咩")
            },
            reboot: function () {
                let value = 1
                this.finallytime(value)
            },
            shutdown: function () {
                let value = 0
                this.finallytime(value)
            },
            upload_video:function (){
                if(!this.is_login){
                    alert("登录")
                    return
                }
                if(!this.this_user_admin){
                    alert("仅限管理员可上传视频")
                    return
                }
                layer.open({
                    type: 2,
                    title: '上传视频',
                    closeBtn: 1,
                    area: ['700px', '400px'],
                    shadeClose: true,
                    shade: false,
                    content: "{% url 'upload_page' %}",
                    end:function(){
                            var handle_status = $("#handle_status").val();
                            if ( handle_status == '1' ) {
                                layer.msg('连接成功！',{
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                },function(){
                                    history.go(0);
                                });
                            } else if ( handle_status == '2' ) {
                                layer.msg('连接失败！',{
                                    icon: 2,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                },function(){
                                    history.go(0);
                                });
                            }
                            vm.refreshmsg()
                        }
                  });

            },
            terminal:function(){
                console.log("terminal ready")
                layer.open({
                    type: 2,
                    title: '建立webssh连接',
                    closeBtn: 1,
                    area: ['700px', '550px'],
                    shadeClose: false,
                    shade: false,
                    content: this.terminal_cmd==""?'http://159.75.34.200:8888/?hostname=127.0.0.1&username='+ this.terminal_user+'&password='+ this.terminal_password+'':'http://159.75.34.200:8888/?hostname=127.0.0.1&username='+ this.terminal_user+'&password='+ this.terminal_password+'&command='+this.terminal_cmd+'',
                    end:function(){
                            var handle_status = $("#handle_status").val();
                            if ( handle_status == '1' ) {
                                layer.msg('连接成功！',{
                                    icon: 1,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                },function(){
                                    history.go(0);
                                });
                            } else if ( handle_status == '2' ) {
                                layer.msg('连接失败！',{
                                    icon: 2,
                                    time: 2000 //2秒关闭（如果不配置，默认是3秒）
                                },function(){
                                    history.go(0);
                                });
                            }
                        }
                  });
            },
            getVideo:function (v_id){
                window.open(this.video_url+v_id)
            },
            finallytime: function (value) {
                let sure = prompt("请输入我很他妈确定")
                let param = new URLSearchParams()
                param.append('value', value)
                if (sure == "我很他妈确定") {
                    axios({
                        method: 'POST',
                        url: '{% url 'rebootorshutdown' %}',
                        data: param
                    });
                } else {
                    return
                }
            },
            changeVideosListTag: function (tag){
                for(let key in this.videosList_tags){
                    this.videosList_tags[key] = false
                }
                this.videosList_tags[tag]=true
            },
            getmorenewvideo: async function (){
                this.videosList_isLoading = true
                document.querySelector(".show_more_btn").disabled = "disabled"
                let param = new URLSearchParams()
                param.append("count",this.videosList_new.length)
                result = await axios({
                    method:"POST",
                    url:"{% url 'getmorenewvideo' %}",
                    data: param
                })
                if(result.data.length == 0){
                    this.show_more_btn = false
                    this.show_more_cat = true
                    console.log("到头了")
                    document.querySelector(".show_more_btn").removeAttribute("disabled")
                    return
                }
                else{
                    for(let item of result.data){
                        this.videosList_new.push(item)
                    }
                    document.querySelector(".show_more_btn").removeAttribute("disabled")
                }
                this.videosList_isLoading = false
            },
            getmorecollectvideo :async function(){
                let param = new URLSearchParams()
                param.append("count",this.videosList_collect.length)
                param.append("user_id",this.userdetail.id)
                result = await axios({
                    method:"POST",
                    url:"{% url 'getMoreCollectVideo' %}",
                    data: param
                })
            },
            getmyvideo :async function(){
                let param = new URLSearchParams()
                param.append("user_id",this.userdetail.id)
                result = await axios({
                    method:"POST",
                    url:"{% url 'getmyvideo' %}",
                    data: param
                })
                this.videosList_mine  = result.data
                this.videosPage.total = this.videosList_mine.length
                this.videosPage.page = Math.ceil(this.videosPage.total/8)
                this.videosPage.now = 1
            },
            active_delbtn:function (){
                for(let item of document.querySelectorAll(".videos-each-del")){
                    item.classList.toggle("active")
                }
            },
            closeDelmenu:function (){
                this.showDelMenu = false
                this.delList = []
            },
            delVideo: function(e,v_id){
                this.showDelMenu = true
                for(let item of this.videosList_mine){
                    if(item["v_id"] == v_id){
                        this.delList.push(item)
                    }
                }
            },
            delVideoSure:async function (node){
                sure = this.Del_sure.toLowerCase()
                node =  document.querySelector('#myvideo_'+this.delList[0]["v_id"])
                if(sure=='y'){
                    let param = new URLSearchParams()
                    param.append("v_id",this.delList[0]["v_id"])
                    result = await axios({
                        method:"POST",
                        url:"{% url 'delVideo' %}",
                        data: param
                    })
                    this.refreshmsg()
                    node.style.opacity = 0
                    setTimeout(function(){
                        node.style.display = "none"
                    },500);
                    this.showDelMenu = false
                }
                else{
                    console.log("输入的什么JB")
                }
            },
            refreshmsg:async function (){
                let param = new URLSearchParams()
                param.append("user_id",this.userdetail.id)
                result = await axios({
                    method:"POST",
                    url:"{% url 'refreshmsg' %}",
                    data: param
                })
                this.messages = result.data
            },
            clearmsg:async function (){
                if(this.messages.msgcount==0){
                    alert("本来就没有")
                }
                else{
                    let param = new URLSearchParams()
                    param.append("user_id",this.userdetail.id)
                    result = await axios({
                        method:"POST",
                        url:"{% url 'clearmsg' %}",
                        data: param
                    })
                    console.log(result)
                    this.refreshmsg()
                }
            },
            changeProfileContent:function (tag,e){
                for(let item of document.querySelector(".profile-content-btns").querySelectorAll("li")){
                    item.classList = ""
                }
                e.target.classList = "active"
                for (let key of Object.keys(this.profile_content)) {
                    this.profile_content[key] = false
                }
                this.profile_content[tag] = true

            },
            myvideosNextpage(){
                if(this.videosPage.end <= this.videosPage.total){
                    this.videosPage.begin += 8
                    this.videosPage.end += 8
                }
                else{
                    return
                }
            },
            myvideosPrepage(){
                if(this.videosPage.begin > 0){
                    this.videosPage.begin -= 8
                    this.videosPage.end -= 8
                }
                else{
                    return
                }
            },
        },
        mounted: function () {
            this.is_login_check()
            if(this.is_login){
                this.getmorecollectvideo()
                this.getmyvideo()
                this.refreshmsg()
            }
            if (this.this_user_admin) {
                this.userDetail()
                this.getAllUsers()
                this.serverDetail()
            }
        },
        watch: {
            serverupdate: function () {
                if (this.serverupdate == false) {
                    clearInterval(this.Interval);
                }
                if (this.serverupdate == true) {
                    this.Interval = setInterval(this.serverDetail, 2000);
                }
            },
            AllUsers: function () {
                console.log(this.AllUsers.data)
            }
        }
    })

    let defaultmountains = document.querySelector("#mountains")
    let defaultmountain = document.querySelector("#mountain")
    let defaultlogin = document.querySelector("#defaultlogin")
    let defaultsun = document.querySelector("#sun")
    let defaulttitle = document.querySelector("#defaulttitle")

    window.addEventListener('scroll', function () {
        var value = window.scrollY;
        defaultmountain.style.top = value * 0.5 + "px"
        defaultmountains.style.top = value * 0 + 'px'
        if (defaultlogin) {
            defaultlogin.style.marginTop = value * 1.2 + 'px'
        }
    })
</script>
</html>